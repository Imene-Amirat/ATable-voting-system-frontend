<section class="grid w-full gap-6 md:grid-cols-2">
  <!-- Visuel -->
  <div class="hidden md:block">
    <div
      class="relative overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"
    >
      <img
        class="h-80 w-full object-cover"
        src="https://images.unsplash.com/photo-1526318472351-c75fcf070305?q=80&w=1600&auto=format&fit=crop"
        alt="ÀTable – Inscription"
      />
      <div
        class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"
      ></div>
      <div class="absolute bottom-4 left-4 text-white">
        <div
          class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs ring-1 ring-white/30"
        >
          Rejoins la communauté
        </div>
        <h2 class="mt-2 text-xl font-semibold">Crée ton compte en 1 minute</h2>
      </div>
    </div>
    <p class="mt-3 text-sm text-gray-500">
      Déjà un compte ?
      <a routerLink="/auth/login" class="text-gray-700 underline"
        >Se connecter</a
      >
    </p>
  </div>

  <form [formGroup]="signupForm" (ngSubmit)="signup()" class="space-y-4">
    <!-- ROLE -->
    <div class="mb-5 grid grid-cols-3 gap-2">
      <button
        *ngFor="let r of roles"
        type="button"
        (click)="selectRole(r)"
        [ngClass]="{
          'bg-black text-white': selectedRole === r,
          'bg-white text-black': selectedRole !== r
        }"
        class="rounded-lg border px-3 py-2 text-sm font-medium shadow-sm ring-1 ring-gray-200"
      >
        {{ r }}
      </button>
    </div>

    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <label class="mb-1 block text-sm font-medium">Nom d'utilisateur</label>
        <input
          type="text"
          formControlName="username"
          class="w-full rounded-lg border px-3 py-2 ring-1 ring-gray-200 focus:ring-2 focus:ring-black"
        />
        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('username')?.hasError('required') &&
            signupForm.get('username')?.touched
          "
        >
          Le nom d'utilisateur est obligatoire.
        </p>
        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('username')?.hasError('minlength') &&
            signupForm.get('username')?.touched
          "
        >
          Le nom d'utilisateur doit contenir au moins 3 caractères.
        </p>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Email</label>
        <input
          type="email"
          formControlName="email"
          class="w-full rounded-lg border px-3 py-2 ring-1 ring-gray-200 focus:ring-2 focus:ring-black"
        />
        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('email')?.hasError('required') &&
            signupForm.get('email')?.touched
          "
        >
          L'email est obligatoire.
        </p>

        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('email')?.hasError('email') &&
            signupForm.get('email')?.touched
          "
        >
          Format d'email invalide.
        </p>
      </div>
    </div>

    <!-- Password + Confirm -->
    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <label class="mb-1 block text-sm font-medium">Mot de passe</label>
        <input
          type="password"
          formControlName="password"
          class="w-full rounded-lg border px-3 py-2 ring-1 ring-gray-200 focus:ring-2 focus:ring-black"
        />
        <p class="mt-1 text-xs text-gray-500">
          8+ caractères, 1 majuscule, 1 chiffre.
        </p>
        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('password')?.hasError('required') &&
            signupForm.get('password')?.touched
          "
        >
          Le mot de passe est obligatoire.
        </p>

        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('password')?.hasError('minlength') &&
            signupForm.get('password')?.touched
          "
        >
          Le mot de passe doit contenir au moins 8 caractères.
        </p>

        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="
            signupForm.get('password')?.hasError('pattern') &&
            signupForm.get('password')?.touched
          "
        >
          Le mot de passe doit contenir au moins 1 majuscule et 1 chiffre.
        </p>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium">Confirmer</label>
        <input
          type="password"
          formControlName="confirm"
          class="w-full rounded-lg border px-3 py-2 ring-1 ring-gray-200 focus:ring-2 focus:ring-black"
        />
        <p
          class="mt-1 text-xs text-red-500"
          *ngIf="signupForm.get('confirm')?.touched && !passwordsMatch()"
        >
          Les mots de passe ne correspondent pas.
        </p>
      </div>
    </div>

    <!-- TERMS -->
    <!-- Zone checkbox + texte -->
    <div class="flex items-start gap-3 text-sm">
      <input
        type="checkbox"
        formControlName="acceptTerms"
        class="mt-1 h-4 w-4"
      />

      <span>
        J’accepte les
        <a href="#" class="underline">conditions d’utilisation</a>.
      </span>
    </div>

    <!-- Message d’erreur séparé -->
    <p
      class="mt-1 text-xs text-red-500"
      *ngIf="
        signupForm.get('acceptTerms')?.hasError('required') &&
        signupForm.get('acceptTerms')?.touched
      "
    >
      Vous devez accepter les conditions d’utilisation pour continuer.
    </p>

    <!-- SUCCESS -->
    <p *ngIf="successMessage" class="text-green-600 text-sm">
      {{ successMessage }}
    </p>

    <!-- BUTTON -->
    <button type="submit" class="btn-primary w-full justify-center">
      Créer mon compte
    </button>
  </form>
</section>
